@page "/activities/select-category/{ActivityId:int}"
@using CRUDManagmentWeb.Components.Pages.Auth
@using CRUDManagmentWeb.Models.Category
@inject CRUDManagmentWeb.Services.CategoryService CategoryService
@inject CRUDManagmentWeb.Services.ActivityCategoryService ActivityCategoryService
@inject IJSRuntime JS
@inject NavigationManager Nav
@rendermode InteractiveServer


<div class="user-container">
    <div class="user-card">
        <div class="user-header">
            <h2>Asignar Categoría a la Actividad #@ActivityId</h2>
        </div>
        <hr />

        @if (allCategories is null)
        {
            <p><em>Cargando categorías...</em></p>
        }
        else
        {
            <div class="user-group">
                <label class="user-label">Selecciona una categoría:</label>
                <div class="user-input-wrapper">
                    <select @bind="selectedCategoryId">
                        <option value="0">-- Elige una opción --</option>
                        @foreach (var category in allCategories)
                        {
                            <option value="@category.Id">@category.Name</option>
                        }
                    </select>
                </div>
            </div>

            <div class="user-actions">
                <button class="user-btn" @onclick="HandleSave" disabled="@(selectedCategoryId == 0)">
                    <span class="btn-text">Asignar y Volver</span>
                    <span class="btn-loader">
                        <span class="loader-bar"></span>
                        <span class="loader-bar"></span>
                        <span class="loader-bar"></span>
                    </span>
                </button>

                <button class="user-btn cancel" @onclick="GoBack">
                    <span class="btn-text">Cancelar</span>
                </button>
            </div>
        }
    </div>
</div>
@code {
    [Parameter]
    public int ActivityId { get; set; }

    private List<CategoryDto>? allCategories;
    private int selectedCategoryId;

    protected override async Task OnInitializedAsync()
    {
        allCategories = await CategoryService.GetAllAsync();
    }

    private async Task HandleSave()
    {
        if (selectedCategoryId == 0) return;

        await ActivityCategoryService.AddCategoryAsync(ActivityId, selectedCategoryId);

        GoBack();
    }

    private void GoBack()
    {
        Nav.NavigateTo("/company/activities");
    }
}